---
import "../styles/global.css";
import Navbar from "../components/dashboard/Navbar.astro";
import { ClientRouter } from "astro:transitions";
import AccountDrawer from "../components/common/AccountDrawer.astro";

interface Props {
  credits: number;
  studentInitial: string;
}

const { credits, studentInitial } = Astro.props;
---

<html lang="pt-BR" transition:animate="fade" class="bg-neutral-100 dark:bg-neutral-950">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>

    <!-- View Transitions -->
    <ClientRouter />

    <!-- Aplicar tema imediatamente -->
    <script is:inline>
      function applyTheme() {
        const savedTheme = localStorage.getItem("theme");
        const systemPrefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

        if (savedTheme === "dark" || (!savedTheme && systemPrefersDark)) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      }

      applyTheme();

      document.addEventListener("astro:after-swap", () => {
        applyTheme();
        generateStars();
      });

      function generateStars() {
        const container = document.getElementById("stars");
        if (!container || container.childElementCount > 0) return;

        const starCount = 50;

        for (let i = 0; i < starCount; i++) {
          const star = document.createElement("div");
          star.className = "star";

          const size = Math.random() * 2 + 0.5;
          star.style.width = size + "px";
          star.style.height = size + "px";
          star.style.left = Math.random() * 100 + "%";
          star.style.top = Math.random() * 100 + "%";
          star.style.animationDelay = Math.random() * 3 + "s";
          star.style.animationDuration = Math.random() * 2 + 2 + "s";

          container.appendChild(star);
        }
      }
    </script>
  </head>

  <body
    class="min-h-screen relative overflow-x-hidden
    text-neutral-900 dark:text-neutral-100
    transition-colors duration-300"
  >
    <!-- ðŸŒ¤ LIGHT BACKGROUND -->
    <div class="light-bg fixed inset-0 -z-20 dark:hidden"></div>

    <!-- ðŸŒŒ DARK BACKGROUND -->
    <div class="fixed inset-0 -z-20 hidden dark:block" id="stars"></div>

    <Navbar credits={credits} studentInitial={studentInitial} />

    <main class="max-w-7xl mx-auto px-6 py-10">
      <section class="space-y-12">
        <slot />
      </section>
    </main>

    <AccountDrawer />

  </body>
</html>
