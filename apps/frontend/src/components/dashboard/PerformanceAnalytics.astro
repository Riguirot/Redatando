---
import CompetencyBar from "./CompetencyBar.astro";
import ProgressBar from "./ProgressBar.astro";
import ScoreEvolutionChart from "./ScoreEvolutionChart.astro";

interface Competency {
  label: string;
  value: number;
  max: number;
}

interface Props {
  competencies: Competency[];
  overallProgress: number;
  evolutionTotal: number;
  scoresHistory: number[]; // [600, null, 800...]
}

const {
  competencies,
  overallProgress,
  evolutionTotal,
  scoresHistory = [],
} = Astro.props;

/* -------------------------------
   Converte number[] em estrutura
   temporal para o gr√°fico
-------------------------------- */

const weekLabels = ["Seg", "Ter", "Qua", "Qui", "Sex", "S√°b", "Dom"];

const chartData = weekLabels.map((label, i) => ({
  label,
  score: scoresHistory[i] ?? null,
}));
---

<section class="mb-12">
  <div class="glass-card p-8">

    {/* ---------------- HEADER ---------------- */}

    <div class="flex justify-between items-start mb-8">
      <div>
        <h3 class="text-xl font-bold flex items-center gap-2">
          üìä Desempenho Anal√≠tico
        </h3>
        <p class="text-sm text-neutral-600 dark:text-neutral-400">
          Evolu√ß√£o das Notas
        </p>
      </div>

      <span
        class="
          text-sm font-semibold
          px-4 py-1.5 rounded-full
          bg-purple-100 text-purple-600
          dark:bg-purple-900/40 dark:text-purple-300
        "
      >
        +{evolutionTotal} pontos
      </span>
    </div>

    {/* ---------------- GR√ÅFICO ---------------- */}

    <div class="mb-10">
      <ScoreEvolutionChart data={chartData} />
    </div>

    {/* ---------------- COMPET√äNCIAS ---------------- */}

    <div class="mt-10">
      <h4 class="font-semibold mb-5 text-neutral-800 dark:text-neutral-200">
        Progresso por Compet√™ncias
      </h4>

      <div class="space-y-6">
        {competencies.map((comp) => (
          <CompetencyBar
            label={comp.label}
            value={comp.value}
            max={comp.max}
          />
        ))}
      </div>
    </div>

    {/* ---------------- DIVISOR ---------------- */}

    <div class="my-8 border-t border-neutral-200 dark:border-[#1F2A44]" />

    {/* ---------------- PROGRESSO GERAL ---------------- */}

    <div>
      <div class="flex justify-between items-center mb-3">
        <h4 class="font-semibold text-neutral-800 dark:text-neutral-200">
          Progresso Geral
        </h4>

        <span
          class="
            text-2xl font-bold
            bg-linear-to-r from-purple-500 to-cyan-400
            bg-clip-text text-transparent
          "
        >
          {overallProgress}%
        </span>
      </div>

      <ProgressBar percentage={overallProgress} height="12px" />

      <p class="text-sm mt-4 text-neutral-600 dark:text-neutral-400">
        Voc√™ est√° muito perto da excel√™ncia! Continue praticando
        para maximizar todas as compet√™ncias.
      </p>
    </div>

  </div>
</section>